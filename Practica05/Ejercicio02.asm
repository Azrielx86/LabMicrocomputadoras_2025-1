    PROCESSOR 16f877a
    INCLUDE <p16f877a.inc>

REG0    EQU     0x20
REG1    EQU     0x21

EDO1 	EQU 	0XC0
EDO2	EQU 	0X60
EDO3 	EQU		0X30
EDO4 	EQU		0X90

CONTADOR1 EQU 	0X22
CONTADOR2 EQU 0X23

valor1 equ h'41'
valor2 equ h'42'
valor3 equ h'43'

	ORG 0
	GOTO INICIO
	ORG 5

INICIO:
	;Subrutina para configurar los puertos de I/O
	CALL CONFIG_INICIAL
LOOP:
	MOVLW 0XFF
	MOVWF CONTADOR1
	CLRF	CONTADOR2
	MOVLW 0x07
	ANDWF PORTA,W
	
	ADDWF PCL,F
	GOTO PARO
	GOTO HORARIO
	GOTO ANTIHORARIO
	GOTO CINCO_VUELTAS
	GOTO DIEZ_VUELTAS
	GOTO LOOP
GOTO LOOP

	
PARO:
	CLRF PORTB
	CALL RETARDO_18ms
	GOTO LOOP

HORARIO:
	MOVLW EDO1
	MOVWF PORTB
	CALL retardo
	MOVLW EDO2
	MOVWF PORTB
	CALL retardo
	MOVLW EDO3
	MOVWF PORTB
	CALL retardo
	MOVLW EDO4
	MOVWF PORTB
	CALL retardo
	
	MOVLW  0X01
	XORWF	PORTA,W	
	BTFSS STATUS,Z
	GOTO LOOP	
	GOTO HORARIO

ANTIHORARIO:
	MOVLW EDO4
	MOVWF PORTB
	CALL retardo
	MOVLW EDO3
	MOVWF PORTB
	CALL retardo
	MOVLW EDO2
	MOVWF PORTB
	CALL retardo
	MOVLW EDO1
	MOVWF PORTB
	CALL retardo
	
	MOVLW  0X02
	XORWF	PORTA,W	
	BTFSS STATUS,Z
	GOTO LOOP	
	GOTO ANTIHORARIO

CINCO_VUELTAS
	MOVLW 0X0A
	XORWF	CONTADOR2,W
	BTFSC STATUS, Z	
	GOTO STOP

	MOVLW 0X00
	XORWF	CONTADOR1,W
	BTFSC STATUS, Z	
	GOTO RES_CONT
GIRA:
	DECF	CONTADOR1
	MOVLW EDO1
	MOVWF PORTB
	CALL retardo
	MOVLW EDO2
	MOVWF PORTB
	CALL retardo
	MOVLW EDO3
	MOVWF PORTB
	CALL retardo
	MOVLW EDO4
	MOVWF PORTB
	CALL retardo

	GOTO CINCO_VUELTAS

STOP:
	CLRF PORTB
	MOVLW  0X03
	XORWF	PORTA,W	
	BTFSS STATUS,Z
	GOTO LOOP	
	GOTO STOP
RES_CONT	
	MOVLW 0XFF
	MOVWF CONTADOR1
	INCF	CONTADOR2
	GOTO CINCO_VUELTAS

DIEZ_VUELTAS
	MOVLW 0X14
	XORWF	CONTADOR2,W
	BTFSC STATUS, Z	
	GOTO STOP_1

	MOVLW 0X00
	XORWF	CONTADOR1,W
	BTFSC STATUS, Z	
	GOTO RES_CONT_1
GIRA_1:
	DECF	CONTADOR1
	MOVLW EDO4
	MOVWF PORTB
	CALL retardo
	MOVLW EDO3
	MOVWF PORTB
	CALL retardo
	MOVLW EDO2
	MOVWF PORTB
	CALL retardo
	MOVLW EDO1
	MOVWF PORTB
	CALL retardo

	GOTO DIEZ_VUELTAS

STOP_1:
	CLRF PORTB
	MOVLW  0X04
	XORWF	PORTA,W	
	BTFSS STATUS,Z
	GOTO LOOP	
	GOTO DIEZ_VUELTAS
RES_CONT_1	
	MOVLW 0XFF
	MOVWF CONTADOR1
	INCF	CONTADOR2
	GOTO DIEZ_VUELTAS

CONFIG_INICIAL:
	;Camio al banco 1
	BCF STATUS, RP1	;RP1 = 0
	BSF STATUS, RP0	;RP0 = 1
	
	;configura los pines del puerto B y C como salidas
	CLRF    TRISB       ; TRISB = 0x00
	CLRF    TRISC       ; TRISC = 0x00
	MOVLW   0x06        ; Configura el puerto A
	MOVWF   ADCON1      ;   como entradas digitales
	MOVLW   0x3F
	MOVWF   TRISA

	;Cambio al banco 0 
	BCF STATUS, RP0	; RP0 = 0

	;Limpia los puertos
	CLRF PORTB
	CLRF PORTA
	CLRF PORTC

	RETURN

RETARDO_05ms 
	MOVLW .82
	MOVWF valor1
dos_05: 
	MOVLW .10
	MOVWF valor2
uno_05: 
	DECFSZ 	valor2
	GOTO 	uno_05
	DECFSZ 	valor1
	GOTO 	dos_05
	RETURN

RETARDO_18ms 
	MOVLW .255
	MOVWF valor1
dos_18: 
	MOVLW .118 ; 118
	MOVWF valor2
uno_18: 
	DECFSZ 	valor2
	GOTO 	uno_18
	DECFSZ 	valor1
	GOTO 	dos_18
	RETURN

retardo 
	MOVLW .1
	MOVWF valor1
tres 
	MOVLW .100
	MOVWF valor2
dos 
	MOVLW .82
	MOVWF valor3
uno
	 DECFSZ valor3
	GOTO uno
	DECFSZ valor2
	GOTO dos
	DECFSZ valor1
	GOTO tres
RETURN

END
